
# Системная установка: говорим как живой оператор.
SYSTEM_PROMPT = (
    "Вы — оператор по работе с дебиторской задолженностью. Говорите естественно и по делу, "
    "без канцеляризмов и без упоминания внутренних процессов или инструментов. "
    "Клиент не должен догадываться, что с ним говорит робот."
)

# Финализация краткого ответа (если используется финализатор)
FINALIZE_PROMPT = (
    "Сформируйте сжатый деловой ответ для клиента на основе предшествующего диалога. "
    "Не раскрывайте внутренние процессы."
)

# Клиентские фразы (наружу)
TEMPLATES = {
    # A — вступление
    "intro": (
        "Добрый день!\nМеня зовут {agent_name}, я из компании Яндекс, звоню по договору с Яндекс.Доставкой.\n"
        "Подскажите, пожалуйста, с кем можно обсудить вопрос по оплате от {company}?"
    ),

    # D — обращение к ЛПР
    "lpr_prompt": (
        "Сумма задолженности по акту от {act_date} составляет {act_amount}. "
        "Скажите, когда планируете оплатить задолженность?"
    ),

    # n5 / n6 — обработка названной даты
    "named_date_over_week": (
        "Понимаю. По договору оплата до 15 числа, сейчас задержка существенная. "
        "Скажите, есть ли возможность оплатить в течение ближайших трёх дней? "
        "Зафиксирую дату оплаты: {target_date}."
    ),
    "named_date_within_week": (
        "Хорошо, спасибо. Зафиксировал: оплата ожидается {target_date}."
    ),

    # n7 — предложение оплатить в течение недели
    "pay_within_week": "Сможете оплатить в течение недели?",

    # n8 — согласие на оплату
    "agree_named_date": (
        "Принято. Ожидаем оплату {target_date}. Благодарю."
    ),

    # n9 — предложение реструктуризации
    "restruct_offer": (
        "Подскажите, если сделаем реструктуризацию долга вам удобнее будет оплачивать?"
        "Предлагаю разбить вашу задолженность на несколько платежей в течение текущего месяца, с первым платежом в течение недели и последним не позднее чем через месяц с момента звонка."
        "Согласны с данным предложением? Давайте зафиксируем в письме: первую оплату ожидаем от вас 00.00.0000, последняя оплата не позднее 00.00.0000."
        "Прошу вас ответным письмом подтвердить наши договоренности."
        "В случае отсутствия оплаты мы будем вынуждены передать вас в работу юридического отдела для подготовки судебной претензии. До свидания!"
    ),

    # n10/n11 — предупреждение о претензии
    "pretrial_notice": (
        "Тогда вынужден предупредить: подготовим претензию и направим по e-mail и на юр. адрес. "
        "Просьба оплатить долг {debt_sum} во избежание дополнительных расходов."
    ),

    # n13 — нет ответа
    "first_debtor_letter": (
        "Хорошо, направим письмо с информацией и документами на указанную почту."
    ),

    # n14–n15 — дублирование закрывающих
    "duplicate_closings": (
        "Сегодня отправим закрывающие документы. После получения сможете оплатить? "
        "Подскажите ориентировочную дату."
    ),

    # n16–n18 — клиент утверждает, что оплатил
    "already_paid": (
        "Пока оплаты не видим. Подскажите, когда оплачивали, и направьте, пожалуйста, платёжное поручение на e-mail."
    ),

    # n19–n20 — акт сверки
    "need_recon": (
        "Сегодня направим акт(ы) сверки за весь период. После получения сможете оплатить? "
        "Сориентируете по дате?"
    ),

    # n21–n23 — нужен счёт
    "need_invoice_explain": (
        "Счёт не является первичным документом для оплаты. Могу выслать закрывающие или реквизиты с суммой. "
        "Этого будет достаточно?"
    ),
}

# Описания для классификаторов (без фигурных скобок — иначе Interpolation)
DESC_LPR = (
    "Ты — маршрутизатор диалога по задолженности. По истории сообщений определи, "
    "является ли текущий собеседник лицом, принимающим решения (ЛПР).\n\n"
    "Верни route:\n"
    " - 'ask_lpr' — если реплика неинформативна (приветствие, «алло», «да-да», молчание) "
    "   или не позволяет понять статус собеседника. В этом случае нужно переспросить, "
    "   является ли он ЛПР.\n"
    " - 'is_lpr' — если собеседник явно подтверждает, что он ЛПР (директор, собственник, отвечает за оплату и т.п.).\n"
    " - 'not_lpr' — если собеседник явно НЕ ЛПР (секретарь, бухгалтер без полномочий и т.п.).\n"
    " - 'unknown' — если невозможно однозначно решить — верни 'ask_lpr'.\n\n"
    "В notes кратко объясни причину решения (1-2 фразы)."
)

DESC_REASON = (
    "Ты — классификатор причины отсутствия оплаты. По последним репликам с ЛПР определи route:\n"
    " - 'named_date' — клиент называет дату оплаты (прямую/относительную). Если удалось извлечь дату — верни её "
    "   в target_date (ISO YYYY-MM-DD).\n"
    " - 'claims_our_side' — проблема на нашей стороне (закрывающие, ЛК, нужен счёт, акт сверки, уже оплатил и т.п.).\n"
    " - 'client_issues' — трудности клиента (нет возможности, позже смогу и т.п.).\n"
    " - 'no_answer' — по сути ничего не сказал/не ответил.\n"
    " - 'unknown' — нет уверенности.\n"
    "Если названа дата — постарайся вернуть target_date."
)

DESC_NAMED_DATE_WINDOW = (
    "Ты — классификатор окна даты оплаты. Если в истории есть целевая дата, оцени, в пределах ли она недели.\n"
    "Верни route:\n"
    " - 'named_date_within_week' — если до даты ≤ 7 дней;\n"
    " - 'named_date_over_week' — если > 7 дней;\n"
    " - 'unknown' — если недостаточно данных.\n"
    "При наличии даты верни её в target_date (ISO)."
)

DESC_AGREEMENT = (
    "Ты — классификатор согласия на оплату в течение недели. Верни route:\n"
    " - 'agree' — согласен (или назвал дату в ближайшую неделю). Если прозвучала конкретика — target_date;\n"
    " - 'disagree' — не согласен/не может в течение недели;\n"
    " - 'unknown' — непонятно."
)

DESC_CLAIMS_SUB = (
    "Ты — классификатор подтипа запроса клиента, если он считает, что проблема на нашей стороне.\n"
    "Верни route:\n"
    " - 'duplicate_closings' — нужен дубликат/повтор закрывающих, проблемы со скачиванием в ЛК;\n"
    " - 'already_paid' — уже оплатил (готов предоставить ПП);\n"
    " - 'needs_reconciliation' — нужен акт сверки;\n"
    " - 'needs_invoice' — нужен счёт;\n"
    " - 'unknown' — иначе."
)
